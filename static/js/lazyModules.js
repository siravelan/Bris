app.controller("lazyStuff",['$http','$scope','$window','$location',function($http,$scope,$window,$location){let vm=this;console.log("lazyStuff is executings");$scope.master.data=[];vm.timezone=-(new Date().getTimezoneOffset()/60);vm.rawdata=[];for(var index in $scope.master.recents){if($scope.master.recents.hasOwnProperty(index)){if(Date.now()-$scope.master.recents[index].info.savedAt>1800000&&navigator.onLine){delete $scope.master.recents[index]}}}
if($scope.master.recents.hasOwnProperty($location.path())){$scope.master.location=$scope.master.recents[$location.path()].info.location;$scope.master.data=$scope.master.recents[$location.path()].data}else{if((typeof(Storage)==="undefined"||(typeof(Storage)!=="undefined"&&localStorage.hideFlipDeviceTip!="true"))&&$scope.view.width<=515){$scope.master.hideFlipDeviceTip=!1}
console.log("At line 25");if($location.path().length>3){fetchUsingPlaceName()}else{if(navigator.geolocation){console.log("Trying to fetch position");navigator.geolocation.getCurrentPosition(fetchUsingPosition,fetchUsingApproxPosition)}else{fetchUsingApproxPosition()}}
function fetchUsingPlaceName(){alert("Fetching using place name is not implemented yet!")}
function fetchUsingPosition(position){console.log("Position accessed successfully",position);$scope.master.location=$scope.master.textData.yourExactPosition;let url='/static/php/location-weather.php?lat='+position.coords.latitude+'&long='+position.coords.longitude+'&gmt='+vm.timezone+'&d='+Math.round(Date.now()/(1000*60*30));$http.get(url).success(function(data){Array.prototype.push.apply(vm.rawdata,data.data);processData()}).error(function(data,status){fetchUsingApproxPosition()})}
function fetchUsingApproxPosition(){alert("Fetching using approximate is not implemented yet!")}
function processData(){var data=vm.rawdata;var ndata={};var path="/static/img/modern-icons/";for(var i=0;i<data.length;i++){var icon=data[i].icon;data[i].offset=!1;data[i].showImg=!0;if(/^[\d]+$/.test(icon)){data[i].background="";data[i].foreground=path+icon+".png"}else if(/^\d+d$/.test(icon)){if(icon=="01d"){data[i].background="";data[i].foreground=path+"01db.png"}else if(icon=="02d"){data[i].background=path+"01db.png";data[i].foreground=path+"02f.png"}else{data[i].background=path+"db.png";data[i].foreground=path+icon.substring(0,2)+"f.png"}}else if(/^\d+m$/.test(icon)){if(icon=="01m"){data[i].background=path+"01mb.png"}else{data[i].background=path+"mb.png"}
data[i].foreground=path+icon.substring(0,2)+"f.png"}else if(/^mf\/\d+n\.\d+$/.test(icon)){var phase=icon.substring(7,9);if(!/^mf\/0[12]n\.\d{2}$/.test(icon)){data[i].offset=!0}
data[i].phase=findPhase(phase);if(icon.substring(3,5)==="01"){data[i].showImg=!1}else{data[i].foreground=path+icon.substring(3,5)+"f.png"}}
let weekday_name=$scope.master.textData.weekdays[data[i].day];if(ndata.hasOwnProperty(weekday_name)&&data[i].date!==ndata[weekday_name][0].date){if(ndata.hasOwnProperty(weekday_name+" ")){ndata[weekday_name+" "].push(data[i])}else{ndata[weekday_name+" "]=[data[i]]}}else if(ndata.hasOwnProperty(weekday_name)){ndata[weekday_name].push(data[i])}else{ndata[weekday_name]=[data[i]]}}
var processed_data=[];var i=0;for(var day in ndata){var summaryHours=[[],[],[],[]];var showSummaries=[!1,!1,!1,!1];for(var j=0;j<ndata[day].length;j++){if(ndata[day][j].hourTo>ndata[day][j].hour&&ndata[day][j].hourTo<=6){summaryHours[0].push(ndata[day][j]);ndata[day][j].summarized=!0;ndata[day][j].group=0}else if(ndata[day][j].hourTo>ndata[day][j].hour&&ndata[day][j].hour>=6&&ndata[day][j].hourTo<=12){summaryHours[1].push(ndata[day][j]);ndata[day][j].summarized=!0;ndata[day][j].group=1}else if(ndata[day][j].hourTo>ndata[day][j].hour&&ndata[day][j].hour>=12&&ndata[day][j].hourTo<=18){summaryHours[2].push(ndata[day][j]);ndata[day][j].summarized=!0;ndata[day][j].group=2}else if((ndata[day][j].hourTo=="00"||ndata[day][j].hourTo>ndata[day][j].hour)&&ndata[day][j].hour>=18&&(ndata[day][j].hourTo<=24||ndata[day][j].hourTo=="00")){summaryHours[3].push(ndata[day][j]);ndata[day][j].summarized=!0;ndata[day][j].group=3}else{ndata[day][j].summarized=!1;ndata[day][j].group=0}}
var summaries=[{},{},{},{}];for(var key=0;key<summaryHours.length;key++){if(summaryHours[key].length>0){showSummaries[key]=!0;var totdegs=0;var totprecip=0;var totwind=0;for(var j=0;j<summaryHours[key].length;j++){totdegs+=summaryHours[key][j].degs;totprecip=totprecip*1+summaryHours[key][j].precipitation*1;totwind=totwind*1+summaryHours[key][j].wind*1}
var avdegs=Math.round(totdegs/summaryHours[key].length);var avwind=Math.round(totwind/summaryHours[key].length*10)/10;totprecip=Math.round(totprecip*10)/10;summaries[key]={hour:summaryHours[key][0].hour,hourTo:summaryHours[key][summaryHours[key].length-1].hourTo,background:summaryHours[key][0].background,foreground:summaryHours[key][0].foreground,showImg:summaryHours[key][0].showImg,icon:summaryHours[key][0].icon,degs:avdegs,precipitation:totprecip,wind:avwind};if(/^mf\/\d+n\.\d+$/.test(summaryHours[key][0].icon)){summaries[key].phase=summaryHours[key][0].phase}}}
processed_data[i]={day:day,showFull:[!1,!1,!1,!1],index:i,periods:[],data:ndata[day]};for(var j=0;j<summaries.length;j++){if(showSummaries[j]){processed_data[i].periods.push({summary:summaries[j],showSummary:!0,data:summaryHours[j]})}}
for(var j=0;j<processed_data[i].data.length;j++){if(!processed_data[i].data[j].summarized){processed_data[i].periods.push({showSummary:!1,data:[processed_data[i].data[j]]})}}
for(var j=0;j<processed_data[i].periods.length;j++){processed_data[i].periods[j].group=processed_data[i].periods[j].data[0].group}
processed_data[i].periods.sort(compare);i++}
$scope.master.data=processed_data;console.log("VÃ¦rdataen er behandlet, resultat:",$scope.master.data);if(initialJSON.noNeed||$scope.master.ifHome()){var i=$location.path();$scope.master.recents[i]={data:$scope.master.data,info:{url:$location.path(),location:$scope.master.location,savedAt:Date.now()}}
if(typeof(Storage)!=="undefined"){console.log("Browser supports localStorage, pushing",$scope.master.recents,"to localStorage.recents");console.log("delete $scope.master.recents.toJson()",delete $scope.master.recents.toJSON);localStorage.recents=JSON.stringify($scope.master.recents)}}
console.log("Recents:",$scope.master.recents);function findPhase(x){if(x<=50)return(-x)*0.5;return 25-(x-50)*0.5}}}
angular.element($window).on('resize',function(){$scope.$apply(function(){$scope.view.height=window.innerHeight;$scope.view.width=window.innerWidth;if($scope.view.width>515){$scope.master.hideFlipDeviceTip=!0;if(typeof(Storage)!=="undefined"){localStorage.hideFlipDeviceTip=!0}}})})
function compare(a,b){if(a.data[0].hour<b.data[0].hour)
return-1;if(a.data[0].hour>b.data[0].hour)
return 1;return 0}
function loadCSS(url){if(typeof localStorage[url]!=='undefined'){$scope.master.css+=localStorage[url]}else{$http.get(url).success((data)=>{$scope.master.css+=data;localStorage[url]=data})}}
loadCSS("/static/css/ubuntu.php");loadCSS("/static/css/glyphicons.min.css");if(typeof(Storage)!=="undefined"){let visits=localStorage.visits||0;localStorage.visits=Number(visits)+1}}]);app.controller('searchController',['$http','$scope','$q','domain','$sce',function($http,$scope,$q,domain,$sce){var vm=this;vm.query="";vm.matches=[];vm.error=!1;vm.search=function(){$http.get("https://real-timer-server.tk:2087/place-search.php?input="+vm.query).success((data)=>{console.log(data);vm.matches=data.predictions;for(let i=0;i<vm.matches.length;i++){let country=vm.matches[i].terms[vm.matches[i].terms.length-1].value;if(country=="United States")country="usa";if(country=="Iran")country="irn";if(country=="United Kingdom")country="gbr";if(country=="Germany")country="deu";if(country=="Spain")country="esp";if(country=="Malaysia")country="mys";if(country=="Malta")country="mlt";if(country=="United Arab Emirates")country="are";if(country=="Japan")country="jpn";if(country=="Denmark")country="dnk";vm.matches[i].country=country.substr(0,3).toLowerCase()}})}}]);app.controller('cookieCtrl',['$timeout','$scope',function($timeout,$scope){var vm=this;vm.elem=document.getElementsByClassName('cookie-box')[0];vm.template="";vm.close=function(){vm.elem=document.getElementsByClassName('cookie-box')[0];try{vm.elem.setAttribute('style','opacity:0;')}catch(e){console.warn(e)}
if(typeof(Storage)!=="undefined"){localStorage.cookieAccept="true"}else{document.cookie="cookiescriptaccept=visit"}
$timeout(()=>{if(vm.elem)vm.elem.parentNode.removeChild(vm.elem)},500)}
if((typeof(Storage)!=="undefined"&&localStorage.cookieAccept!="true")&&getCookieValue("cookiescriptaccept")!="visit"){$timeout(function(){vm.elem=document.getElementsByClassName('cookie-box')[0];vm.elem.setAttribute('style','opacity:1;');$timeout(vm.close,5000)},2500)}else if(vm.elem)vm.elem.parentNode.removeChild(vm.elem);function getCookieValue(a,b){b=document.cookie.match('(^|;)\\s*'+a+'\\s*=\\s*([^;]+)');return b?b.pop():''}}])